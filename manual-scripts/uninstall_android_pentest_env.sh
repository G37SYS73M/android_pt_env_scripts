#!/bin/bash

set -e

echo "[*] Removing Android pentesting tools..."

TOOLS_DIR="$HOME/android-pentest-tools"
ANDROID_SDK_DIR="$HOME/Android/Sdk"
BASHRC="$HOME/.bashrc"

# Remove APKTool symlinks
sudo rm -f /usr/local/bin/apktool /usr/local/bin/apktool.jar

# Remove JADX, apktool, pidcat directories
rm -rf "$TOOLS_DIR"

# Remove JADX path from .bashrc
sed -i '/jadx\/build\/jadx\/bin/d' "$BASHRC"

# Remove ANDROID_HOME export from .bashrc
sed -i '/ANDROID_HOME/d' "$BASHRC"

# Remove PATH additions for Android tools
sed -i '/cmdline-tools\/latest\/bin/d' "$BASHRC"
sed -i '/platform-tools/d' "$BASHRC"

# Remove Android SDK
rm -rf "$ANDROID_SDK_DIR"

# Remove pidcat symlink
sudo rm -f /usr/local/bin/pidcat

# Uninstall frida and objection
echo "[*] Attempting to uninstall Python tools (frida-tools, objection)..."

# Prefer pipx
if command -v pipx >/dev/null 2>&1; then
    pipx uninstall frida-tools || echo "[!] frida-tools was not installed via pipx"
    pipx uninstall objection || echo "[!] objection was not installed via pipx"
else
    echo "[!] pipx not found. Trying pip with --break-system-packages (if necessary)."

    if command -v pip >/dev/null 2>&1; then
        pip uninstall -y frida-tools objection 2>/dev/null || \
        pip uninstall --break-system-packages -y frida-tools objection || \
        echo "[!] Manual cleanup might be needed (e.g., deleting from /usr/local/lib/python3*/dist-packages/)"
    else
        echo "[!] pip not installed or unavailable"
    fi
fi

echo "[+] Uninstallation complete."
echo "[!] Please restart your terminal or run: source ~/.bashrc"
